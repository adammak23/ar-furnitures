<!DOCTYPE html>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<link rel="stylesheet" href="test.css">
<html lang="pl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wegovy AR</title>
  </head>
<!--
  src="/model-viewer-test/assets/box.glb"
  ios-src="/model-viewer-test/assets/box.usdz"
              min-camera-orbit='auto auto 100%'
              max-camera-orbit='auto auto 100%'
              min-field-of-view='110deg'
              max-field-of-view='110deg'

-->
<body>
    <model-viewer
              src="/model-viewer-test/assets/wegovy.glb"
              ios-src="/model-viewer-test/assets/wegovy.usdz"
              alt="3D model couldnt be displayed"
              shadow-intensity="1"
              
              environment-image="https://modelviewer.dev/shared-assets/environments/aircraft_workshop_01_1k.hdr"
              exposure="1"
              ar-modes="scene-viewer webxr quick-look"
              ar
              camera-controls
              camera-target="0m 0m 0m"
              camera-orbit="0deg 55deg 0m"
              disable-tap
              pan-target="0m 99m 0m"
              min-field-of-view='2deg'
              max-field-of-view='20deg'
              
              style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; border: none;"
              >           

            <div class="progress-bar hide" slot="progress-bar">
                <div class="update-bar"></div>
            </div>

            <button slot="ar-button" id="ar-button">
                View in your space
            </button>

            <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css">

            <a class="home-button" onclick="home()">
              <i class="fas fa-home"></i> Home
            </a>

            <div id="ar-prompt">
                <img src="https://modelviewer.dev/shared-assets/icons/hand.png">
            </div>
            
            <button id="ar-failure">
                AR is not tracking!
            </button>

            <div class="container">
              <div class="header-box">
                  <div class="text-box">
                      <h2>Instrukcja stosowania leku Wegovy</h2>
                  </div>
              </div>
              <div class="text-box">
                  <p>Lek Wegovy jest dostępny w pięciu różnych wstrzykiwaczach,</p>
                  <p>z których każdy zawiera odpowiednią przepisana dawkę semaglutydu:</p>
                </div>
              <div>
                  <span class="dose dose-1">0,25 mg</span>
                  <span class="dose dose-2">0,5 mg</span>
                  <span class="dose dose-3">1 mg</span>
                  <span class="dose dose-4">1,7 mg</span>
                  <span class="dose dose-5">2,4 mg</span>
              </div>
              <div>
                  <a class="button" onclick="playAnimation(this, 0)">Zdjęcie nasadki wstrzykiwacza</a>
                  <a class="button" onclick="playAnimation(this, 1)">Zdjęcie igły</a>
                  <a class="button" onclick="playAnimation(this, 2)">Sprawdzenie przepływu</a>                  
              </div>
          </div>
        </model-viewer>
</body>
</html>


<script type="module">
  // blender has 24fps animation so 1000/24 = 41.66666 but this number doesnt work for some reason?
  const FrameToMS = 1000/24;
  // start time is in seconds
  // length is in miliseconds

  const animation1_Start = 48/24;
  const animation1_Length = FrameToMS * (370-48);
  
  const animation2_Start = 382/24;
  const animation2_Length = FrameToMS * (740 - 382);

  const animation3_Start = 750/24;
  const animation3_Length = FrameToMS * (1300 - 750);

  var timeoutID;

    window.playAnimation = (element, animationIndex) =>
    {
      const modelViewer = document.querySelector("model-viewer");
      modelViewer.play();      

      var animStartTime = 0;
      var animLength = 0;
      if(animationIndex == 0)
      {
        animStartTime = animation1_Start;
        animLength = animation1_Length;
      }
      else if(animationIndex == 1)
      {
        animStartTime = animation2_Start;
        animLength = animation2_Length;
      }
      else if(animationIndex == 2)
      {
        animStartTime = animation3_Start;
        animLength = animation3_Length;
      }

      //console.log(animationIndex + " " + animStartTime + " " + animLength);

      modelViewer.currentTime = animStartTime;
      clearTimeout(timeoutID);

      let container = document.querySelector('.container');
      container.classList.remove('fade-in');
      container.classList.add('fade-out');

      timeoutID = self.setTimeout(()=>
      {
        modelViewer.pause();
        let container = document.querySelector('.container');
        container.classList.remove('fade-out');
        container.classList.add('fade-in');
      }, animLength);
    };

    window.home = (element, animationIndex) =>
    {
        clearTimeout(timeoutID)

        let container = document.querySelector('.container');
        container.classList.remove('fade-out');
        container.classList.add('fade-in');

        const modelViewer = document.querySelector("model-viewer");
        modelViewer.currentTime = 48/24;
        modelViewer.pause();
    };

</script>

<script>
  function executeOnStartup()
  {
    const modelViewer = document.querySelector('model-viewer');
    modelViewer.addEventListener('model-visibility', function(evt)
    {
      const modelViewer = document.querySelector("model-viewer");

      modelViewer.play();
      modelViewer.currentTime = 48/24;
      modelViewer.pause();
    })
  }
  window.onload = executeOnStartup;
</script>

<!--
<script type="text/javascript">
  function executeOnStartup()
  {
    alert('ok');
  }
  window.onload = executeOnStartup;
</script>
-->

<style>

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.fade-out {
    animation: fadeOut 0.5s forwards;
    pointer-events: none;
}

.fade-in {
    animation: fadeIn 0.5s forwards;
    pointer-events: auto;
}

  body
  {
    animation: fadeIn 0.5s forwards;
    font-family: Apis, sans-serif;
    text-align: center;
    color: #001956;
  }

        .text-box
        {
            color: #001956;
            background-color: white;
            border: 2px solid #001956;
            border-radius: 0px;
            margin: 5px auto;
            text-align: center;
            width: fit-content;
            padding-inline: 15px;            
        }

        .header-box
        {
          padding-top: 20px;
          display: flex;
          flex-direction: column;
          align-items: center;
        }
        .button {
          color: #001956;
          display: inline-block;
          padding: 15px;
          margin: 5px;
          background-color: #fff;
          border: 2px solid #001956;
          border-radius: 15px;
          text-decoration: none;
          font-weight: bold;
        }
        .button:hover
        {
          background-color: lightblue;
        }

        .home-button {
          font-family: Apis, sans-serif;
          background-color: #fff;          
          position: absolute;
          top: 20px;
          right: 20px;
          padding: 10px 20px;
          color: #001956;
          align-self:flex-end;
          border: 2px solid #001956;
          border-radius: 15px;
          font-weight: bold;
        }
        .home-button:hover
        {
          background-color: lightblue;
        }
        .dose {
            display: inline-block;
            padding: 10px;
            margin: 5px;
            border: 2px solid #001956;
            border-radius: 0px;
            color: white;
        }
        .dose-1 { background-color: #4CAF50; }
        .dose-2 { background-color: #C760A2; }
        .dose-3 { background-color: #A0522D; }
        .dose-4 { background-color: #4169E1; }
        .dose-5 { background-color: #696969; }

  /* This keeps child nodes hidden while the element loads */
  :not(:defined) > * {
      display: none;
    }
  
    model-viewer {
      background-color: #eee;
      overflow-x: hidden;
    }

    #ar-button {
      background-image: url(https://modelviewer.dev/assets/ic_view_in_ar_new_googblue_48dp.png);
      background-repeat: no-repeat;
      background-size: 20px 20px;
      background-position: 12px 50%;
      background-color: #fff;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      bottom: 132px;
      padding: 0px 16px 0px 40px;
      font-family: Apis, sans-serif;
      font-size: 14px;
      color:#4285f4;
      height: 36px;
      line-height: 36px;
      border-radius: 18px;
      border: 1px solid #DADCE0;
    }
  
    #ar-button:active {
      background-color: #E8EAED;
    }
  
    #ar-button:focus {
      outline: none;
    }
  
    #ar-button:focus-visible {
      outline: 1px solid #4285f4;
    }
  
    @keyframes circle {
      from { transform: translateX(-50%) rotate(0deg) translateX(50px) rotate(0deg); }
      to   { transform: translateX(-50%) rotate(360deg) translateX(50px) rotate(-360deg); }
    }
  
    @keyframes elongate {
      from { transform: translateX(100px); }
      to   { transform: translateX(-100px); }
    }
  
    model-viewer > #ar-prompt {
      position: absolute;
      left: 50%;
      bottom: 175px;
      animation: elongate 2s infinite ease-in-out alternate;
      display: none;
    }
  
    model-viewer[ar-status="session-started"] > #ar-prompt {
      display: block;
    }
  
    model-viewer > #ar-prompt > img {
      animation: circle 4s linear infinite;
    }
  
    model-viewer > #ar-failure {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 175px;
      display: none;
    }
  
    model-viewer[ar-tracking="not-tracking"] > #ar-failure {
      display: block;
    }

</style>